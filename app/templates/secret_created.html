{% extends "base.html" %}
{% block title %}Secret ready Â· Whispers{% endblock %}
{% block content %}
<section class="card focus">
    <div class="card-header">
        <h2>Your secret is ready to share</h2>
        <p>Send the link below to the intended recipients. Only authorized users will be able to open it.</p>
    </div>
    {% if secret.title %}
    <div class="meta">
        <span>Title: <strong>{{ secret.title }}</strong></span>
    </div>
    {% endif %}
    <div class="share-panel">
        <label for="share-url">Shareable link</label>
        <div class="share-input">
            <input id="share-url" type="text" readonly value="{{ secret.share_url }}" />
            <button class="btn secondary copy-button" type="button" data-copy-target="share-url">Copy</button>
        </div>
        <p class="help-text">The secret expires at <strong>{{ secret.expires_at.strftime('%Y-%m-%d %H:%M %Z') }}</strong>.</p>
    </div>
    <div class="form-actions">
        <a class="btn primary" href="/">Create another secret</a>
    </div>
</section>
{% endblock %}
{% block scripts %}
<script>
document.querySelectorAll('.copy-button').forEach((button) => {
    button.addEventListener('click', async () => {
        const targetId = button.getAttribute('data-copy-target');
        const input = document.getElementById(targetId);
        if (!input) {
            return;
        }

        const text = input.value;

        try {
            if (navigator.clipboard && window.isSecureContext) {
                await navigator.clipboard.writeText(text);
            } else {
                input.select();
                input.setSelectionRange(0, text.length);
                document.execCommand('copy');
            }

            button.classList.add('copied');
            button.textContent = 'Copied!';
            setTimeout(() => {
                button.classList.remove('copied');
                button.textContent = 'Copy';
            }, 1800);
        } catch (err) {
            console.error('Failed to copy secret link', err);
        }
    });
});
</script>
{% endblock %}
